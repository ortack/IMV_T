{% extends "base.html" %}
{% load i18n %}
{% load static %}
{% block title %}Gestor IMV{% endblock %}
{% block head %}
<meta http-equiv="refresh" content="5;  "/>
{% endblock %}
{% block content %}
<div style="text-align: center;">
    <h1>{{ descripcion }}, Total Tarjetas: {{ tarjetas_count }}</h1>
</div>
<div class="contenedor">
  <div class="row">
    <div class="col-md-3">
      <div id="tabla1-container" class="table-container">
        <h3>Pendiente de Hospital: {{pendiente_hospi}}</h3>
        <h3>Pendiente de traslado: {{pendiente_traslado}}</h3>
      </div>
    </div>
    <div class="col-md-9">
      <div map="map" id="map" style="width: 100%; height: 800px;"></div>
    </div>
  </div>
</div>
<script>
    var latitud = {{ latitud }}; // Latitud del evento
    var longitud = {{ longitud }}; // Longitud del evento

    // Crear el mapa
    var map = L.map('map').setView([latitud, longitud], 17.5);

    // Agregar capa de OpenStreetMap
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors',
        maxZoom: 30,
    }).addTo(map);

    // Iterar sobre tarjetas_red_coords para agregar marcadores rojos
    var tarjetasRedCoords = {{ tarjetas_red_coords|safe }};
    var tarjetasVerdeCoords = {{ tarjetas_verde_coords|safe }};
    var tarjetasAmarilloCoords = {{ tarjetas_amarillo_coords|safe }};
    var tarjetasMoradoCoords = {{ tarjetas_morado_coords|safe }};
    var tarjetasNegroCoords = {{ tarjetas_negro_coords|safe }};
    tarjetasRedCoords.forEach(function(tarjeta) {
        if (tarjeta.lat && tarjeta.lon) { // Verificar que las coordenadas existan
            L.marker([tarjeta.lat, tarjeta.lon], {
              icon: L.icon({
                iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-red.png', // Ícono rojo
                shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-shadow.png', // Sombra del marcador
                iconSize: [25, 41], // Tamaño del ícono
                iconAnchor: [12, 41], // Punto de anclaje
                popupAnchor: [1, -34], // Punto de anclaje del popup
                shadowSize: [41, 41] // Tamaño de la sombra
            })
            }).addTo(map);
        }
    });
  tarjetasVerdeCoords.forEach(function(tarjeta) {
      if (tarjeta.lat && tarjeta.lon) { // Verificar que las coordenadas existan
          L.marker([tarjeta.lat, tarjeta.lon], {
            icon: L.icon({
              iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-green.png', // Ícono rojo
              shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-shadow.png', // Sombra del marcador
              iconSize: [25, 41], // Tamaño del ícono
              iconAnchor: [12, 41], // Punto de anclaje
              popupAnchor: [1, -34], // Punto de anclaje del popup
              shadowSize: [41, 41] // Tamaño de la sombra
          })
          }).addTo(map);
      }
  });
  tarjetasAmarilloCoords.forEach(function(tarjeta) {
    if (tarjeta.lat && tarjeta.lon) { // Verificar que las coordenadas existan
        L.marker([tarjeta.lat, tarjeta.lon], {
          icon: L.icon({
            iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-yellow.png', // Ícono rojo
            shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-shadow.png', // Sombra del marcador
            iconSize: [25, 41], // Tamaño del ícono
            iconAnchor: [12, 41], // Punto de anclaje
            popupAnchor: [1, -34], // Punto de anclaje del popup
            shadowSize: [41, 41] // Tamaño de la sombra
        })
        }).addTo(map);
    }
});
tarjetasMoradoCoords.forEach(function(tarjeta) {
  if (tarjeta.lat && tarjeta.lon) { // Verificar que las coordenadas existan
      L.marker([tarjeta.lat, tarjeta.lon], {
        icon: L.icon({
          iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-blue.png', // Ícono rojo
          shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-shadow.png', // Sombra del marcador
          iconSize: [25, 41], // Tamaño del ícono
          iconAnchor: [12, 41], // Punto de anclaje
          popupAnchor: [1, -34], // Punto de anclaje del popup
          shadowSize: [41, 41] // Tamaño de la sombra
      })
      }).addTo(map);
  }
});
tarjetasNegroCoords.forEach(function(tarjeta) {
  if (tarjeta.lat && tarjeta.lon) { // Verificar que las coordenadas existan
      L.marker([tarjeta.lat, tarjeta.lon], {
        icon: L.icon({
          iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-black.png', // Ícono rojo
          shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-shadow.png', // Sombra del marcador
          iconSize: [25, 41], // Tamaño del ícono
          iconAnchor: [12, 41], // Punto de anclaje
          popupAnchor: [1, -34], // Punto de anclaje del popup
          shadowSize: [41, 41] // Tamaño de la sombra
      })
      }).addTo(map);
  }
});

</script>
{% endblock %}






















